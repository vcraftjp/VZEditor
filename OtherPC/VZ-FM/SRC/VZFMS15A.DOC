============================================================================
       ＶZ Editor Ver1.60 FM版 L15a ソース差分 について
						                   1994.4.10
　　　　　　　　　　　　　　　　　　　　　　　　　　　　　k.tok (徳田  楠男)
                                                      NIFTY Serve : PEC00071
============================================================================

■　ファイルの内容

	VZFMS15a.DOC	本ファイル
	MKSRC.BAT	FM版 ソース生成バッチ (解凍/リネーム/差分を自動化)
	VZFMS15a.COM	98版 1.60 → FM版 1.60 L15a への差分 (WSP 使用)
	VZFM.INC	FM版 VZ.INC
	MAKEFILE	FM版 VZの Makefile (MicorSoft の nmake 専用)
	MKFM.COM        FM版 VZを作るバッチ (環境変数領域を大量に必要とします)
	VZFM.OMK	FM版 VZの Makefile (OptAsm 専用)

	以上のうち，MAKEFILE,MKSRC.BAT は，Aiming Off 氏が公表された L15β 版に
	収められたものと同じです。


■  ＦＭ版用に変更の加わったファイル一覧 (差分対象)

	STD      INC	 7631  93-12-06   2:00	→  7781  94-03-04
	VZ       INC	15674  93-12-06   2:00	→ 15797  94-01-16 (VZORG.INC)
	SPRINTF  INC	 4127  91-12-16   1:57	→  4261  94-03-28
	MAIN     ASM	36672  93-12-06   2:00	→ 38573  94-03-24
	CORE     ASM	19033  93-12-06   2:00	→ 19586  94-01-17
	DISP     ASM	13392  93-12-06   2:00	→ 13644  94-01-15
	DOS      ASM	19346  93-12-06   2:00	→ 23186  94-03-19
	EXPR     ASM	15254  93-12-06   2:00	→ 15496  94-02-18
	FILER    ASM	56931  93-12-06   2:00	→ 60594  94-03-27
	INST     ASM	22431  93-12-06   2:00	→ 23016  94-03-27
	KEY      ASM	14044  93-12-06   2:00	→ 15970  94-03-21
	KEY98    ASM	13065  93-12-06   2:00	→ 28127  94-03-27 (KEYFM.ASM)
	MACRO    ASM	42169  93-12-06   2:00	→ 44029  94-03-27
	OPEN     ASM	29937  93-12-06   2:00	→ 30060  94-03-04
	SCRN     ASM	 6193  93-12-06   2:00  →  8068  94-03-24
	SCRN98   ASM	25670  93-12-06   2:00	→ 49965  94-04-10 (SCRNFM.ASM)
	SMOOTH   ASM	 4600  93-12-06   2:00	→  5285  94-03-23
	STRING   ASM	18237  93-12-06   2:00	→ 18614  94-01-17
	TEXT     ASM	30587  93-12-06   2:00	→ 31223  94-03-04
	XSCR     ASM	 7061  93-12-06   2:00	→  7370  94-02-11
	EMS      ASM	15591  93-12-06   2:00	→ 15741  94-03-04
	MSG      ASM	 6685  93-12-06   2:00	→  7877  94-03-28


■　差分によるファイルの更新ツール

      今回から，自己アップデート形式になりましたので，特にツールは必要ありませ
    ん。以下のフリーソフトウェアを使わせていただきました。

	WSP  version 1.50                ; 小さな差分作成・更新プログラム
	copyright (C) amaproワキチ  1992-93


■　アップデートの方法

  1) 差分集の LZH ファイルを, 充分余裕のあるワークディレクトリで解凍します。
  2) オリジナルのＶZの圧縮ソースファイル (\SRC\SRC.EXE) を(1)のワークディレクト
     リへ解凍します。
  3) (1) のワークディレクトリをカレントディレクトリとし, 以下のことを行います。

	C>vzfms15a
	C>copy vzfm.inc vz.inc

     ※ MKSRC.BAT は (2)〜(3) をバッチで実行するものです。
        また，VZFMDxx.DOC に添付の MAKVZFM.COM でもアップデートできます。


■　アセンブルの方法

    VzFM V1.57 L14d 以前と変更ありません。

    mkfm [機種名] [STD|SLIM]

    環境変数領域を多量に消費しますので，十分に環境変数の領域を確保しておいて
  ください。
    機種名は，下記を参考にしてください。
    
    なお，MicroSoft の MASM と NMAKE を使用する場合には, 添付の Makefile を使
  ってもアセンブルできます。(MASM V5.1 以降. Makefile を書き換えれば他のアセン
  ブラでも可能でしょうが, NMAKE 以外の MAKE ではダメでしょう。)
    この際には, 上記のアップデートを行ったディレクトリで, 以下のようにアセン
  ブルする機種名をパラメータにして NMAKE を実行してください。

	C>nmake R60

  機種名として指定できるのは, 以下のものです。

	R60	: FMR-60 FMR-70 FMR-80 FMR-280 (高解像度機種)
	R50	: FMR-50 FMR-10 FMR-CARD FM-TOWNS (FMR-30 を除く中解像度機種)
	R30	: FMR-50 FMR-30 FMR-10 FMR-CARD FM-TOWNS (中解像度機種)
	FMT	: FM-TOWNS
	16B	: FM-16β

  　NMAKE を使用した場合，機種名は, 複数を空白で区切って指定することもできます｡
  また，機種名に all を指定すると上記の全ての機種用の VZ が作成されます。

    機能の一部を無効にした限定版の VzFM を作成したい場合には, vz.inc のファイ
  ルを修正して特定のアセンブルスイッチを有効にしてください。 (Makefile を修正
  するという手もありますが…)


■　FM版修正内容について

    従来の VzFM V1.57 L14d や VZ 1.6 の98版オリジナルとの違いについては, 別の
  ドキュメント (VZFMD???.LZH の中の VZFM???.DOC,VZFM.DOC) を参照してください。
    ここでは, 追加したアセンブルスイッチを中心に説明します。
    以下は，Aiming Off さんの書かれたドキュメントに加筆してあります。

  1)  FM_xxxx というアセンブルスイッチは, ファイラーモードとしてオリジナルで
  　使われるようになったので, 紛らわしくないように従来の FM_xxxx のスイッチは
    FMX_xxxx という名前に変更しました。

  2)  アセンブルスイッチ FMX_NOGAIJI
      これは昔からあった丸文字表示オプション。丸文字表示対応機能を無効にする。
    オプション変数 VM で制御できるため, 実行ファイルサイズを小さくしたい人に
    だけ意味があります。

  3)  アセンブルスイッチ NO_JIS83
      初期の FMR では JIS罫線が表示されないので, それを変換表示する機能。この
    スイッチを指定すると JIS罫線変換表示機能を無効にします。これも, オプショ
    ン変数 VM で制御できるため, 実行ファイルサイズを小さくしたい人にだけ意味
    があります。TOWNS版やFM-16β版は標準で指定されています。

  4)  アセンブルスイッチ FMX_NOCVT98 / FMX_CVT98MINI
      PC-9801 罫線や○数字を変換表示する機能を無効にします。FMX_CVT98MINI も
    指定すると, 太線も細線も細い罫線で表示します。MINIの方は単なるサイズをケ
    チるためのもので, VZ 1.6 になった今ではあまり意味はないかもしれません。
      オプション変数 VM で制御できるため, 実行ファイルサイズを小さくしたい人
    にだけ意味があります。

  5)  アセンブルスイッチ FMX_NOCVTOAS
      OASYS の罫線や○数字を変換表示する機能を無効にします。 高解像度機種版で
    の Windows や OS/2 のフォントの『富士通拡張文字』のコードの変換表示も無効
    になります。
      オプション変数 VM で制御できるため, 実行ファイルサイズを小さくしたい人
    にだけ意味があります。

  6)  アセンブルスイッチ FMX_NOEXTATTR
      FMR高解像度版の拡張表示属性を無効にします。 具体的には, カーソル色の指
    定, 文字単位の背景色, アンダーライン色の指定を無効にします。

  7)  アセンブルスイッチ FMX_NOEXTFLATR
      ファイラーでボリュームラベルを表示したり, Archive属性のないファイルを
    別の色で表示したりする機能を無効にします。

  8)  アセンブルスイッチ FMX_NOEXTSPEXE
      ファイラーのコマンドメニューの %/ と %E の機能を無効にします。

  9)  アセンブルスイッチ FMX_NOEXTVZBAK
      Eb+ で環境変数 VZBAK が指定されている場合, Bd+ を指定するとそのドライブ
    に VZBAK で指定したディレクトリが存在しない時にはディレクトリを新たに作ら
    ない機能を無効にします。

 10)  アセンブルスイッチ FMX_NONOSTOP
      コマンドラインのマルチステートメントの途中でエラーしても中断しない機能
    (オプション変数 NS+) を無効にします。

 11)  アセンブルスイッチ ATOK7 / FMX_NOMSKANJI
      標準では, ATOK7 や MS-KANJI が使えるように設定。動作は未確認。MS-KANJI
    については, OAK も MS-KANJI I/F を持っているので, これで確認した限りでは
    うまく動いているようです。
      FMX_OAKONLY を指定すると ATOK7 は無効になりますが, MS-KANJI は生かした
    ままにしています (L14d とはこの点が違います)。本当に OAK しか使わないよう
    な人は FMX_OAKONLY と FMX_NOMSKANJI の両方を指定するとサイズが小さくなり
    ます。

 12)  アセンブルスイッチ FMX_NOALTKMAT
      今は隠しスイッチになっていますが, DOS 5.0 以降はキーBIOS で [ALT] キー
    のシフト状態が通知されるようになりましたので, キーマトリックスのスキャン
    をするのをやめるスイッチを追加しました。 &k を使う Game系のマクロの動作が
    安定することを期待しましたが, 確かに良くなっているものの, まだ完全ではな
    いようです。

 13)  アセンブルスイッチ FMX_NOSHIFTTENK
      DOS のレベルがある程度以降 (V3.1 L31A ?) ならば [CTRL]+[ﾃﾝｷｰ] が入力で
    きるため, それができない者のための救済策である [SHIFT]+[ﾃﾝｷｰ] による代用
    の機能を無効にします。

 14)  アセンブルスイッチ FMX_NOINTBREAK
      不法な割り込みが発生する原因がほぼ判明したので, もうこれを指定する必要
    はないと思います。

 15)  アセンブルスイッチ FMX_NOGVRAM
      スイッチそのものは残っているが, 既にソース上でコメントになっているので
    指定しても無意味です。

 16)  アセンブルスイッチ FMX_NOPALETTE
      TOWNS版でカラーパレットの設定をしないスイッチです。以前のは，逆のスイッ
    チ (カラーパレットの設定をする) でしたが，変更してあります。

 17)  アセンブルスイッチ FMX_NOBACKCOLOR
      TOWNS版で背景色のカラーパレットの設定をしないスイッチです。上記の 16)
    が定義されていると，このスイッチは何の意味も持ちません。

 18)  オリジナル版のバグ修正
      98オリジナル版に残っているバグの中で, FVC に修正情報がアップされていた
    ものの一部は既に組み込んであります。(filer.asm の中の余計な div 命令と, 
    ems.asm の中の bx の push/pop ,sprintf.inc)

 19)  できるだけ V1.6 オリジナルのコードを生かすようにしました。コード領域に
 　 余裕ができたので, 単なるダミールーチンコールも, 以前のように，敢えてアセ
 　 ンブルスイッチでカットしていません。

 20)  19) に伴い, 従来使っていなかった hardware というワークをそのまま使うよ
    うにしました。このため, hardware のワークのある org 100h 付近に余裕がな
    くなったため, 従来あったレベル表示『VZ1.57 L14d』をカットしました。
                                       　　　　^^^^
    (これは, FGALPK の方ではこの hardware を絶対番地で参照して機種を判断する
    ようなタコなマクロを作る人もおり, これの対応にも必要と判断しました。)

 21)  PC98 というアセンブルスイッチを生かしたままにするのは疑問のため,
    vzorg.inc にも手を入れました。(従来は vzorg.inc はオリジナルの vz.inc そ
    のもので, 全く変更されていませんでした。)
